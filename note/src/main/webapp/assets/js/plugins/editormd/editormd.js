(function(e){"use strict";typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"?define.amd||define(["jquery"],e):window.editormd=e()})(function(){"use strict";var e=typeof jQuery!="undefined"?jQuery:Zepto;if(typeof e=="undefined")return;var t=function(e,n){return new t.fn.init(e,n)};t.title=t.$name="Editor.md",t.version="1.5.0",t.homePage="https://pandao.github.io/editor.md/",t.classPrefix="editormd-",t.toolbarModes={full:["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help"],simple:["undo","redo","|","bold","del","italic","quote","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","watch","preview","fullscreen","|","help"],mini:["undo","redo","|","watch","preview","|","help"]},t.defaults={mode:"gfm",name:"",value:"",theme:"",editorTheme:"default",previewTheme:"",markdown:"",appendMarkdown:"",width:"100%",height:"100%",path:"./lib/",pluginPath:"",delay:300,autoLoadModules:!0,watch:!0,placeholder:"Enjoy Markdown! coding now...",gotoLine:!0,codeFold:!1,autoHeight:!1,autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:"#fff",dialogMaskOpacity:.1,fontSize:"13px",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:"",crossDomainUpload:!1,uploadCallbackURL:"",toc:!0,tocm:!1,tocTitle:"",tocDropdown:!1,tocContainer:"",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:"full",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return t.toolbarHandlers.ucwords},lowercase:function(){return t.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:'<a href="javascript:;" title="Lowercase" unselectable="on"><i class="fa" name="lowercase" style="font-size:24px;margin-top: -10px;">a</i></a>',ucwords:'<a href="javascript:;" title="ucwords" unselectable="on"><i class="fa" name="ucwords" style="font-size:20px;margin-top: -3px;">Aa</i></a>'},toolbarIconsClass:{undo:"fa-undo",redo:"fa-repeat",bold:"fa-bold",del:"fa-strikethrough",italic:"fa-italic",quote:"fa-quote-left",uppercase:"fa-font",h1:t.classPrefix+"bold",h2:t.classPrefix+"bold",h3:t.classPrefix+"bold",h4:t.classPrefix+"bold",h5:t.classPrefix+"bold",h6:t.classPrefix+"bold","list-ul":"fa-list-ul","list-ol":"fa-list-ol",hr:"fa-minus",link:"fa-link","reference-link":"fa-anchor",image:"fa-picture-o",code:"fa-code","preformatted-text":"fa-file-code-o","code-block":"fa-file-code-o",table:"fa-table",datetime:"fa-clock-o",emoji:"fa-smile-o","html-entities":"fa-copyright",pagebreak:"fa-newspaper-o","goto-line":"fa-terminal",watch:"fa-eye-slash",unwatch:"fa-eye",preview:"fa-desktop",search:"fa-search",fullscreen:"fa-arrows-alt",clear:"fa-eraser",help:"fa-question-circle",info:"fa-info-circle"},toolbarIconTexts:{},lang:{name:"zh-cn",description:"开源在线Markdown编辑器<br/>Open source online Markdown editor.",tocTitle:"目录",toolbar:{undo:"撤销（Ctrl+Z）",redo:"重做（Ctrl+Y）",bold:"粗体",del:"删除线",italic:"斜体",quote:"引用",ucwords:"将每个单词首字母转成大写",uppercase:"将所选转换成大写",lowercase:"将所选转换成小写",h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6","list-ul":"无序列表","list-ol":"有序列表",hr:"横线",link:"链接","reference-link":"引用链接",image:"添加图片",code:"行内代码","preformatted-text":"预格式文本 / 代码块（缩进风格）","code-block":"代码块（多语言风格）",table:"添加表格",datetime:"日期时间",emoji:"Emoji表情","html-entities":"HTML实体字符",pagebreak:"插入分页符","goto-line":"跳转到行",watch:"关闭实时预览",unwatch:"开启实时预览",preview:"全窗口预览HTML（按 Shift + ESC还原）",fullscreen:"全屏（按ESC还原）",clear:"清空",search:"搜索",help:"使用帮助"},buttons:{enter:"确定",cancel:"取消",close:"关闭"},dialog:{link:{title:"添加链接",url:"链接地址",urlTitle:"链接标题",urlEmpty:"错误：请填写链接地址。"},referenceLink:{title:"添加引用链接",name:"引用名称",url:"链接地址",urlId:"链接ID",urlTitle:"链接标题",nameEmpty:"错误：引用链接的名称不能为空。",idEmpty:"错误：请填写引用链接的ID。",urlEmpty:"错误：请填写引用链接的URL地址。"},image:{title:"添加图片",url:"图片地址",link:"图片链接",alt:"图片描述",uploadButton:"本地上传",imageURLEmpty:"错误：图片地址不能为空。",uploadFileEmpty:"错误：上传的图片不能为空。",formatNotAllowed:"错误：只允许上传图片文件，允许上传的图片文件格式有："},preformattedText:{title:"添加预格式文本或代码块",emptyAlert:"错误：请填写预格式文本或代码的内容。"},codeBlock:{title:"添加代码块",selectLabel:"代码语言：",selectDefaultText:"请选择代码语言",otherLanguage:"其他语言",unselectedLanguageAlert:"错误：请选择代码所属的语言类型。",codeEmptyAlert:"错误：请填写代码内容。"},htmlEntities:{title:"HTML 实体字符"},help:{title:"使用帮助"}}}},t.classNames={tex:t.classPrefix+"tex"},t.dialogZindex=99999,t.$katex=null,t.$marked=null,t.$CodeMirror=null,t.$prettyPrint=null;var n,r;t.prototype=t.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(n,r){r=r||{},typeof n=="object"&&(r=n);var i=this,s=this.classPrefix=t.classPrefix,o=this.settings=e.extend(!0,t.defaults,r);n=typeof n=="object"?o.id:n;var u=this.editor=e("#"+n);this.id=n,this.lang=o.lang;var a=this.classNames={textarea:{html:s+"html-textarea",markdown:s+"markdown-textarea"}};o.pluginPath=o.pluginPath===""?o.path+"../plugins/":o.pluginPath,this.state.watching=o.watch?!0:!1,u.hasClass("editormd")||u.addClass("editormd"),u.css({width:typeof o.width=="number"?o.width+"px":o.width,height:typeof o.height=="number"?o.height+"px":o.height}),o.autoHeight&&u.css("height","auto");var f=this.markdownTextarea=u.children("textarea");f.length<1&&(u.append("<textarea></textarea>"),f=this.markdownTextarea=u.children("textarea")),f.addClass(a.textarea.markdown).attr("placeholder",o.placeholder),(typeof f.attr("name")=="undefined"||f.attr("name")==="")&&f.attr("name",o.name!==""?o.name:n+"-markdown-doc");var l=[o.readOnly?"":'<a href="javascript:;" class="fa fa-close '+s+'preview-close-btn"></a>',o.saveHTMLToTextarea?'<textarea class="'+a.textarea.html+'" name="'+n+'-html-code"></textarea>':"",'<div class="'+s+'preview"><div class="markdown-body '+s+'preview-container"></div></div>','<div class="'+s+'container-mask" style="display:block;"></div>','<div class="'+s+'mask"></div>'].join("\n");return u.append(l).addClass(s+"vertical"),o.theme!==""&&u.addClass(s+"theme-"+o.theme),this.mask=u.children("."+s+"mask"),this.containerMask=u.children("."+s+"container-mask"),o.markdown!==""&&f.val(o.markdown),o.appendMarkdown!==""&&f.val(f.val()+o.appendMarkdown),this.htmlTextarea=u.children("."+a.textarea.html),this.preview=u.children("."+s+"preview"),this.previewContainer=this.preview.children("."+s+"preview-container"),o.previewTheme!==""&&this.preview.addClass(s+"preview-theme-"+o.previewTheme),typeof define=="function"&&define.amd&&(typeof katex!="undefined"&&(t.$katex=katex),o.searchReplace&&!o.readOnly&&(t.loadCSS(o.path+"codemirror/addon/dialog/dialog"),t.loadCSS(o.path+"codemirror/addon/search/matchesonscrollbar"))),typeof define=="function"&&define.amd||!o.autoLoadModules?(typeof CodeMirror!="undefined"&&(t.$CodeMirror=CodeMirror),typeof marked!="undefined"&&(t.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var e=this,n=this.settings,r=n.path,i=function(){if(t.isIE8){e.loadedDisplay();return}n.flowChart||n.sequenceDiagram?t.loadScript(r+"raphael.min",function(){t.loadScript(r+"underscore.min",function(){!n.flowChart&&n.sequenceDiagram?t.loadScript(r+"sequence-diagram.min",function(){e.loadedDisplay()}):n.flowChart&&!n.sequenceDiagram?t.loadScript(r+"flowchart.min",function(){t.loadScript(r+"jquery.flowchart.min",function(){e.loadedDisplay()})}):n.flowChart&&n.sequenceDiagram&&t.loadScript(r+"flowchart.min",function(){t.loadScript(r+"jquery.flowchart.min",function(){t.loadScript(r+"sequence-diagram.min",function(){e.loadedDisplay()})})})})}):e.loadedDisplay()};return t.loadCSS(r+"codemirror/codemirror.min"),n.searchReplace&&!n.readOnly&&(t.loadCSS(r+"codemirror/addon/dialog/dialog"),t.loadCSS(r+"codemirror/addon/search/matchesonscrollbar")),n.codeFold&&t.loadCSS(r+"codemirror/addon/fold/foldgutter"),t.loadScript(r+"codemirror/codemirror.min",function(){t.$CodeMirror=CodeMirror,t.loadScript(r+"codemirror/modes.min",function(){t.loadScript(r+"codemirror/addons.min",function(){e.setCodeMirror();if(n.mode!=="gfm"&&n.mode!=="markdown")return e.loadedDisplay(),!1;e.setToolbar(),t.loadScript(r+"marked.min",function(){t.$marked=marked,n.previewCodeHighlight?t.loadScript(r+"prettify.min",function(){i()}):i()})})})}),this},setTheme:function(e){var t=this.editor,n=this.settings.theme,r=this.classPrefix+"theme-";return t.removeClass(r+n).addClass(r+e),this.settings.theme=e,this},setEditorTheme:function(e){var n=this.settings;return n.editorTheme=e,e!=="default"&&t.loadCSS(n.path+"codemirror/theme/"+n.editorTheme),this.cm.setOption("theme",e),this},setCodeMirrorTheme:function(e){return this.setEditorTheme(e),this},setPreviewTheme:function(e){var t=this.preview,n=this.settings.previewTheme,r=this.classPrefix+"preview-theme-";return t.removeClass(r+n).addClass(r+e),this.settings.previewTheme=e,this},setCodeMirror:function(){var e=this.settings,n=this.editor;e.editorTheme!=="default"&&t.loadCSS(e.path+"codemirror/theme/"+e.editorTheme);var r={mode:e.mode,theme:e.editorTheme,tabSize:e.tabSize,dragDrop:!1,autofocus:e.autoFocus,autoCloseTags:e.autoCloseTags,readOnly:e.readOnly?"nocursor":!1,indentUnit:e.indentUnit,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,extraKeys:{"Ctrl-Q":function(e){e.foldCode(e.getCursor())}},foldGutter:e.codeFold,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:e.matchBrackets,indentWithTabs:e.indentWithTabs,styleActiveLine:e.styleActiveLine,styleSelectedText:e.styleSelectedText,autoCloseBrackets:e.autoCloseBrackets,showTrailingSpace:e.showTrailingSpace,highlightSelectionMatches:e.matchWordHighlight?{showToken:e.matchWordHighlight==="onselected"?!1:/\w/}:!1};return this.codeEditor=this.cm=t.$CodeMirror.fromTextArea(this.markdownTextarea[0],r),this.codeMirror=this.cmElement=n.children(".CodeMirror"),e.value!==""&&this.cm.setValue(e.value),this.codeMirror.css({fontSize:e.fontSize,width:e.watch?"50%":"100%"}),e.autoHeight&&(this.codeMirror.css("height","auto"),this.cm.setOption("viewportMargin",Infinity)),e.lineNumbers||this.codeMirror.find(".CodeMirror-gutters").css("border-right","none"),e.watch&&this.codeMirror.css("border-right","1px solid #ddd"),this},getCodeMirrorOption:function(e){return this.cm.getOption(e)},setCodeMirrorOption:function(e,t){return this.cm.setOption(e,t),this},addKeyMap:function(e,t){return this.cm.addKeyMap(e,t),this},removeKeyMap:function(e){return this.cm.removeKeyMap(e),this},gotoLine:function(t){var n=this.settings;if(!n.gotoLine)return this;var r=this.cm,i=this.editor,s=r.lineCount(),o=this.preview;typeof t=="string"&&(t==="last"&&(t=s),t==="first"&&(t=1));if(typeof t!="number")return alert("Error: The line number must be an integer."),this;t=parseInt(t)-1;if(t>s)return alert("Error: The line number range 1-"+s),this;r.setCursor({line:t,ch:0});var u=r.getScrollInfo(),a=u.clientHeight,f=r.charCoords({line:t,ch:0},"local");r.scrollTo(null,(f.top+f.bottom-a)/2);if(n.watch){var l=this.codeMirror.find(".CodeMirror-scroll")[0],c=e(l).height(),h=l.scrollTop,p=h/l.scrollHeight;h===0?o.scrollTop(0):h+c>=l.scrollHeight-16?o.scrollTop(o[0].scrollHeight):o.scrollTop(o[0].scrollHeight*p)}return r.focus(),this},extend:function(){return typeof arguments[1]!="undefined"&&(typeof arguments[1]=="function"&&(arguments[1]=e.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),typeof arguments[0]=="object"&&typeof arguments[0].length=="undefined"&&e.extend(!0,this,arguments[0]),this},set:function(t,n){return typeof n!="undefined"&&typeof n=="function"&&(n=e.proxy(n,this)),this[t]=n,this},config:function(t,n){var r=this.settings;return typeof t=="object"&&(r=e.extend(!0,r,t)),typeof t=="string"&&(r[t]=n),this.settings=r,this.recreate(),this},on:function(t,n){var r=this.settings;return typeof r["on"+t]!="undefined"&&(r["on"+t]=e.proxy(n,this)),this},off:function(e){var t=this.settings;return typeof t["on"+e]!="undefined"&&(t["on"+e]=function(){}),this},showToolbar:function(t){var n=this.settings;return n.readOnly?this:(n.toolbar&&(this.toolbar.length<1||this.toolbar.find("."+this.classPrefix+"menu").html()==="")&&this.setToolbar(),n.toolbar=!0,this.toolbar.show(),this.resize(),e.proxy(t||function(){},this)(),this)},hideToolbar:function(t){var n=this.settings;return n.toolbar=!1,this.toolbar.hide(),this.resize(),e.proxy(t||function(){},this)(),this},setToolbarAutoFixed:function(t){var n=this.state,r=this.editor,i=this.toolbar,s=this.settings;typeof t!="undefined"&&(s.toolbarAutoFixed=t);var o=function(){var t=e(window),n=t.scrollTop();if(!s.toolbarAutoFixed)return!1;n-r.offset().top>10&&n<r.height()?i.css({position:"fixed",width:r.width()+"px",left:(t.width()-r.width())/2+"px"}):i.css({position:"absolute",width:"100%",left:0})};return!n.fullscreen&&!n.preview&&s.toolbar&&s.toolbarAutoFixed&&e(window).bind("scroll",o),this},setToolbar:function(){var e=this.settings;if(e.readOnly)return this;var n=this.editor,r=this.preview,i=this.classPrefix,s=this.toolbar=n.children("."+i+"toolbar");if(e.toolbar&&s.length<1){var o='<div class="'+i+'toolbar"><div class="'+i+'toolbar-container"><ul class="'+i+'menu"></ul></div></div>';n.append(o),s=this.toolbar=n.children("."+i+"toolbar")}if(!e.toolbar)return s.hide(),this;s.show();var u=typeof e.toolbarIcons=="function"?e.toolbarIcons():typeof e.toolbarIcons=="string"?t.toolbarModes[e.toolbarIcons]:e.toolbarIcons,a=s.find("."+this.classPrefix+"menu"),f="",l=!1;for(var c=0,h=u.length;c<h;c++){var p=u[c];if(p==="||")l=!0;else if(p==="|")f+='<li class="divider" unselectable="on">|</li>';else{var d=/h(\d)/.test(p),v=p;p==="watch"&&!e.watch&&(v="unwatch");var m=e.lang.toolbar[v],g=e.toolbarIconTexts[v],y=e.toolbarIconsClass[v];m=typeof m=="undefined"?"":m,g=typeof g=="undefined"?"":g,y=typeof y=="undefined"?"":y;var b=l?'<li class="pull-right">':"<li>";typeof e.toolbarCustomIcons[p]!="undefined"&&typeof e.toolbarCustomIcons[p]!="function"?b+=e.toolbarCustomIcons[p]:(b+='<a href="javascript:;" title="'+m+'" unselectable="on">',b+='<i class="fa '+y+'" name="'+p+'" unselectable="on">'+(d?p.toUpperCase():y===""?g:"")+"</i>",b+="</a>"),b+="</li>",f=l?b+f:f+b}}return a.html(f),a.find('[title="Lowercase"]').attr("title",e.lang.toolbar.lowercase),a.find('[title="ucwords"]').attr("title",e.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return e.proxy(t.dialogLockScreen,this)(),this},dialogShowMask:function(n){return e.proxy(t.dialogShowMask,this)(n),this},getToolbarHandles:function(e){var n=this.toolbarHandlers=t.toolbarHandlers;return e&&typeof toolbarIconHandlers[e]!="undefined"?n[e]:n},setToolbarHandler:function(){var n=this,r=this.settings;if(!r.toolbar||r.readOnly)return this;var i=this.toolbar,s=this.cm,o=this.classPrefix,u=this.toolbarIcons=i.find("."+o+"menu > li > a"),a=this.getToolbarHandles();return u.bind(t.mouseOrTouch("click","touchend"),function(t){var i=e(this).children(".fa"),o=i.attr("name"),u=s.getCursor(),f=s.getSelection();if(o==="")return;return n.activeIcon=i,typeof a[o]!="undefined"?e.proxy(a[o],n)(s):typeof r.toolbarHandlers[o]!="undefined"&&e.proxy(r.toolbarHandlers[o],n)(s,i,u,f),o!=="link"&&o!=="reference-link"&&o!=="image"&&o!=="code-block"&&o!=="preformatted-text"&&o!=="watch"&&o!=="preview"&&o!=="search"&&o!=="fullscreen"&&o!=="info"&&s.focus(),!1}),this},createDialog:function(n){return e.proxy(t.createDialog,this)(n)},createInfoDialog:function(){var e=this,n=this.editor,r=this.classPrefix,i=['<div class="'+r+"dialog "+r+'dialog-info" style="">','<div class="'+r+'dialog-container">','<h1><i class="editormd-logo editormd-logo-lg editormd-logo-color"></i> '+t.title+"<small>v"+t.version+"</small></h1>","<p>"+this.lang.description+"</p>",'<p style="margin: 10px 0 20px 0;"><a href="'+t.homePage+'" target="_blank">'+t.homePage+' <i class="fa fa-external-link"></i></a></p>','<p style="font-size: 0.85em;">Copyright &copy; 2015 <a href="https://github.com/pandao" target="_blank" class="hover-link">Pandao</a>, The <a href="https://github.com/pandao/editor.md/blob/master/LICENSE" target="_blank" class="hover-link">MIT</a> License.</p>',"</div>",'<a href="javascript:;" class="fa fa-close '+r+'dialog-close"></a>',"</div>"].join("\n");n.append(i);var s=this.infoDialog=n.children("."+r+"dialog-info");return s.find("."+r+"dialog-close").bind(t.mouseOrTouch("click","touchend"),function(){e.hideInfoDialog()}),s.css("border",t.isIE8?"1px solid #ddd":"").css("z-index",t.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var t=this.infoDialog,n=function(){t.css({top:(e(window).height()-t.height())/2+"px",left:(e(window).width()-t.width())/2+"px"})};return n(),e(window).resize(n),this},showInfoDialog:function(){e("html,body").css("overflow-x","hidden");var n=this,r=this.editor,i=this.settings,s=this.infoDialog=r.children("."+this.classPrefix+"dialog-info");return s.length<1&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:i.dialogMaskOpacity,backgroundColor:i.dialogMaskBgColor}).show(),s.css("z-index",t.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return e("html,body").css("overflow-x",""),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(e){return t.lockScreen(e),this.resize(),this},recreate:function(){var e=this,t=this.editor,n=this.settings;return this.codeMirror.remove(),this.setCodeMirror(),n.readOnly||(t.find(".editormd-dialog").length>0&&t.find(".editormd-dialog").remove(),n.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),this},previewCodeHighlight:function(){var e=this.settings,t=this.previewContainer;return e.previewCodeHighlight&&(t.find("pre").addClass("prettyprint linenums"),typeof prettyPrint!="undefined"&&prettyPrint()),this},katexRender:function(){return n===null?this:(this.previewContainer.find("."+t.classNames.tex).each(function(){var n=e(this);t.$katex.render(n.text(),n[0]),n.find(".katex").css("font-size","1.6em")}),this)},flowChartAndSequenceDiagramRender:function(){var n=this,i=this.settings,s=this.previewContainer;if(t.isIE8)return this;if(i.flowChart){if(r===null)return this;s.find(".flowchart").flowChart()}i.sequenceDiagram&&s.find(".sequence-diagram").sequenceDiagram({theme:"simple"});var o=n.preview,u=n.codeMirror,a=u.find(".CodeMirror-scroll"),f=a.height(),l=a.scrollTop(),c=l/a[0].scrollHeight,h=0;o.find(".markdown-toc-list").each(function(){h+=e(this).height()});var p=o.find(".editormd-toc-menu").height();return p=p?p:0,l===0?o.scrollTop(0):l+f>=a[0].scrollHeight-16?o.scrollTop(o[0].scrollHeight):o.scrollTop((o[0].scrollHeight+h+p)*c),this},registerKeyMaps:function(n){var r=this,i=this.cm,s=this.settings,o=t.toolbarHandlers,u=s.disabledKeyMaps;n=n||null;if(n){for(var a in n)if(e.inArray(a,u)<0){var f={};f[a]=n[a],i.addKeyMap(n)}}else{for(var l in t.keyMaps){var c=t.keyMaps[l],h=typeof c=="string"?e.proxy(o[c],r):e.proxy(c,r);if(e.inArray(l,["F9","F10","F11"])<0&&e.inArray(l,u)<0){var p={};p[l]=h,i.addKeyMap(p)}}e(window).keydown(function(t){var n={120:"F9",121:"F10",122:"F11"};if(e.inArray(n[t.keyCode],u)<0)switch(t.keyCode){case 120:return e.proxy(o.watch,r)(),!1;case 121:return e.proxy(o.preview,r)(),!1;case 122:return e.proxy(o.fullscreen,r)(),!1;default:}})}return this},bindScrollEvent:function(){var n=this,r=this.preview,i=this.settings,s=this.codeMirror,o=t.mouseOrTouch;if(!i.syncScrolling)return this;var u=function(){s.find(".CodeMirror-scroll").bind(o("scroll","touchmove"),function(t){var s=e(this).height(),o=e(this).scrollTop(),u=o/e(this)[0].scrollHeight,a=0;r.find(".markdown-toc-list").each(function(){a+=e(this).height()});var f=r.find(".editormd-toc-menu").height();f=f?f:0,o===0?r.scrollTop(0):o+s>=e(this)[0].scrollHeight-16?r.scrollTop(r[0].scrollHeight):r.scrollTop((r[0].scrollHeight+a+f)*u),e.proxy(i.onscroll,n)(t)})},a=function(){s.find(".CodeMirror-scroll").unbind(o("scroll","touchmove"))},f=function(){r.bind(o("scroll","touchmove"),function(t){var r=e(this).height(),o=e(this).scrollTop(),u=o/e(this)[0].scrollHeight,a=s.find(".CodeMirror-scroll");o===0?a.scrollTop(0):o+r>=e(this)[0].scrollHeight?a.scrollTop(a[0].scrollHeight):a.scrollTop(a[0].scrollHeight*u),e.proxy(i.onpreviewscroll,n)(t)})},l=function(){r.unbind(o("scroll","touchmove"))};return s.bind({mouseover:u,mouseout:a,touchstart:u,touchend:a}),i.syncScrolling==="single"?this:(r.bind({mouseover:f,mouseout:l,touchstart:f,touchend:l}),this)},bindChangeEvent:function(){var e=this,t=this.cm,r=this.settings;return r.syncScrolling?(t.on("change",function(t,i){r.watch&&e.previewContainer.css("padding",r.autoHeight?"20px 20px 50px 40px":"20px"),n=setTimeout(function(){clearTimeout(n),e.save(),n=null},r.delay)}),this):this},loadedDisplay:function(t){t=t||!1;var n=this,r=this.editor,i=this.preview,s=this.settings;return this.containerMask.hide(),this.save(),s.watch&&i.show(),r.data("oldWidth",r.width()).data("oldHeight",r.height()),this.resize(),this.registerKeyMaps(),e(window).resize(function(){n.resize()}),this.bindScrollEvent().bindChangeEvent(),t||e.proxy(s.onload,this)(),this.state.loaded=!0,this},width:function(e){return this.editor.css("width",typeof e=="number"?e+"px":e),this.resize(),this},height:function(e){return this.editor.css("height",typeof e=="number"?e+"px":e),this.resize(),this},resize:function(t,n){t=t||null,n=n||null;var r=this.state,i=this.editor,s=this.preview,o=this.toolbar,u=this.settings,a=this.codeMirror;t&&i.css("width",typeof t=="number"?t+"px":t),u.autoHeight&&!r.fullscreen&&!r.preview?(i.css("height","auto"),a.css("height","auto")):(n&&i.css("height",typeof n=="number"?n+"px":n),r.fullscreen&&i.height(e(window).height()),u.toolbar&&!u.readOnly?a.css("margin-top",o.height()+1).height(i.height()-o.height()):a.css("margin-top",0).height(i.height()));if(u.watch){a.width(i.width()/2),s.width(r.preview?i.width():i.width()/2),this.previewContainer.css("padding",u.autoHeight?"20px 20px 50px 40px":"20px"),u.toolbar&&!u.readOnly?s.css("top",o.height()+1):s.css("top",0);if(u.autoHeight&&!r.fullscreen&&!r.preview)s.height("");else{var f=u.toolbar&&!u.readOnly?i.height()-o.height():i.height();s.height(f)}}else a.width(i.width()),s.hide();return r.loaded&&e.proxy(u.onresize,this)(),this},save:function(){if(n===null)return this;var i=this,s=this.state,o=this.settings,u=this.cm,a=u.getValue(),f=this.previewContainer;if(o.mode!=="gfm"&&o.mode!=="markdown")return this.markdownTextarea.val(a),this;var l=t.$marked,c=this.markdownToC=[],h=this.markedRendererOptions={toc:o.toc,tocm:o.tocm,tocStartLevel:o.tocStartLevel,pageBreak:o.pageBreak,taskList:o.taskList,emoji:o.emoji,tex:o.tex,atLink:o.atLink,emailLink:o.emailLink,flowChart:o.flowChart,sequenceDiagram:o.sequenceDiagram,previewCodeHighlight:o.previewCodeHighlight},p=this.markedOptions={renderer:t.markedRenderer(c,h),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:o.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};l.setOptions(p);var d=t.$marked(a,p);d=t.filterHTMLTags(d,o.htmlDecode),this.markdownTextarea.text(a),u.save(),o.saveHTMLToTextarea&&this.htmlTextarea.text(d);if(o.watch||!o.watch&&s.preview){f.html(d),this.previewCodeHighlight();if(o.toc){var v=o.tocContainer===""?f:e(o.tocContainer),m=v.find("."+this.classPrefix+"toc-menu");v.attr("previewContainer",o.tocContainer===""?"true":"false"),o.tocContainer!==""&&m.length>0&&m.remove(),t.markdownToCRenderer(c,v,o.tocDropdown,o.tocStartLevel),(o.tocDropdown||v.find("."+this.classPrefix+"toc-menu").length>0)&&t.tocDropdownMenu(v,o.tocTitle!==""?o.tocTitle:this.lang.tocTitle),o.tocContainer!==""&&f.find(".markdown-toc").css("border","none")}o.tex&&(!t.kaTeXLoaded&&o.autoLoadModules?t.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,i.katexRender()}):(t.$katex=katex,this.katexRender()));if(o.flowChart||o.sequenceDiagram)r=setTimeout(function(){clearTimeout(r),i.flowChartAndSequenceDiagramRender(),r=null},10);s.loaded&&e.proxy(o.onchange,this)()}return this},focus:function(){return this.cm.focus(),this},setCursor:function(e){return this.cm.setCursor(e),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(e,t){return this.cm.setSelection(e,t),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(e){return this.cm.setSelections(e),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(e){return this.cm.replaceSelection(e),this},insertValue:function(e){return this.replaceSelection(e),this},appendMarkdown:function(e){var t=this.settings,n=this.cm;return n.setValue(n.getValue()+e),this},setMarkdown:function(e){return this.cm.setValue(e||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(e){return this.cm.setValue(e),this},clear:function(){return this.cm.setValue(""),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert("Error: settings.saveHTMLToTextarea == false"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert("Error: settings.watch == false"),!1)},watch:function(t){var r=this.settings;if(e.inArray(r.mode,["gfm","markdown"])<0)return this;this.state.watching=r.watch=!0,this.preview.show();if(this.toolbar){var i=r.toolbarIconsClass.watch,s=r.toolbarIconsClass.unwatch,o=this.toolbar.find(".fa[name=watch]");o.parent().attr("title",r.lang.toolbar.watch),o.removeClass(s).addClass(i)}return this.codeMirror.css("border-right","1px solid #ddd").width(this.editor.width()/2),n=0,this.save().resize(),r.onwatch||(r.onwatch=t||function(){}),e.proxy(r.onwatch,this)(),this},unwatch:function(t){var n=this.settings;this.state.watching=n.watch=!1,this.preview.hide();if(this.toolbar){var r=n.toolbarIconsClass.watch,i=n.toolbarIconsClass.unwatch,s=this.toolbar.find(".fa[name=watch]");s.parent().attr("title",n.lang.toolbar.unwatch),s.removeClass(r).addClass(i)}return this.codeMirror.css("border-right","none").width(this.editor.width()),this.resize(),n.onunwatch||(n.onunwatch=t||function(){}),e.proxy(n.onunwatch,this)(),this},show:function(t){t=t||function(){};var n=this;return this.editor.show(0,function(){e.proxy(t,n)()}),this},hide:function(t){t=t||function(){};var n=this;return this.editor.hide(0,function(){e.proxy(t,n)()}),this},previewing:function(){var n=this,r=this.editor,i=this.preview,s=this.toolbar,o=this.settings,u=this.codeMirror,a=this.previewContainer;if(e.inArray(o.mode,["gfm","markdown"])<0)return this;o.toolbar&&s&&(s.toggle(),s.find(".fa[name=preview]").toggleClass("active")),u.toggle();var f=function(e){e.shiftKey&&e.keyCode===27&&n.previewed()};u.css("display")==="none"?(this.state.preview=!0,this.state.fullscreen&&i.css("background","#fff"),r.find("."+this.classPrefix+"preview-close-btn").show().bind(t.mouseOrTouch("click","touchend"),function(){n.previewed()}),o.watch?a.css("padding",""):this.save(),a.addClass(this.classPrefix+"preview-active"),i.show().css({position:"",top:0,width:r.width(),height:o.autoHeight&&!this.state.fullscreen?"auto":r.height()}),this.state.loaded&&e.proxy(o.onpreviewing,this)(),e(window).bind("keyup",f)):(e(window).unbind("keyup",f),this.previewed())},previewed:function(){var n=this.editor,r=this.preview,i=this.toolbar,s=this.settings,o=this.previewContainer,u=n.find("."+this.classPrefix+"preview-close-btn");return this.state.preview=!1,this.codeMirror.show(),s.toolbar&&i.show(),r[s.watch?"show":"hide"](),u.hide().unbind(t.mouseOrTouch("click","touchend")),o.removeClass(this.classPrefix+"preview-active"),s.watch&&o.css("padding","20px"),r.css({background:null,position:"absolute",width:n.width()/2,height:s.autoHeight&&!this.state.fullscreen?"auto":n.height()-i.height(),top:s.toolbar?i.height():0}),this.state.loaded&&e.proxy(s.onpreviewed,this)(),this},fullscreen:function(){var t=this,n=this.state,r=this.editor,i=this.preview,s=this.toolbar,o=this.settings,u=this.classPrefix+"fullscreen";s&&s.find(".fa[name=fullscreen]").parent().toggleClass("active");var a=function(e){!e.shiftKey&&e.keyCode===27&&n.fullscreen&&t.fullscreenExit()};return r.hasClass(u)?(e(window).unbind("keyup",a),this.fullscreenExit()):(n.fullscreen=!0,e("html,body").css("overflow","hidden"),r.css({width:e(window).width(),height:e(window).height()}).addClass(u),this.resize(),e.proxy(o.onfullscreen,this)(),e(window).bind("keyup",a)),this},fullscreenExit:function(){var t=this.editor,n=this.settings,r=this.toolbar,i=this.classPrefix+"fullscreen";return this.state.fullscreen=!1,r&&r.find(".fa[name=fullscreen]").parent().removeClass("active"),e("html,body").css("overflow",""),t.css({width:t.data("oldWidth"),height:t.data("oldHeight")}).removeClass(i),this.resize(),e.proxy(n.onfullscreenExit,this)(),this},executePlugin:function(n,r){var i=this,s=this.cm,o=this.settings;return r=o.pluginPath+r,typeof define=="function"?typeof this[n]=="undefined"?(alert("Error: "+n+" plugin is not found, you are not load this plugin."),this):(this[n](s),this):(e.inArray(r,t.loadFiles.plugin)<0?t.loadPlugin(r,function(){t.loadPlugins[n]=i[n],i[n](s)}):e.proxy(t.loadPlugins[n],this)(s),this)},search:function(e){var t=this.settings;return t.searchReplace?(t.readOnly||this.cm.execCommand(e||"find"),this):(alert("Error: settings.searchReplace == false"),this)},searchReplace:function(){return this.search("replace"),this},searchReplaceAll:function(){return this.search("replaceAll"),this}},t.fn.init.prototype=t.fn,t.dialogLockScreen=function(){var t=this.settings||{dialogLockScreen:!0};t.dialogLockScreen&&(e("html,body").css("overflow","hidden"),this.resize())},t.dialogShowMask=function(t){var n=this.editor,r=this.settings||{dialogShowMask:!0};t.css({top:(e(window).height()-t.height())/2+"px",left:(e(window).width()-t.width())/2+"px"}),r.dialogShowMask&&n.children("."+this.classPrefix+"mask").css("z-index",parseInt(t.css("z-index"))-1).show()},t.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection("**"+n+"**"),n===""&&e.setCursor(t.line,t.ch+2)},del:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection("~~"+n+"~~"),n===""&&e.setCursor(t.line,t.ch+2)},italic:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection("*"+n+"*"),n===""&&e.setCursor(t.line,t.ch+1)},quote:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("> "+n),e.setCursor(t.line,t.ch+2)):e.replaceSelection("> "+n)},ucfirst:function(){var e=this.cm,n=e.getSelection(),r=e.listSelections();e.replaceSelection(t.firstUpperCase(n)),e.setSelections(r)},ucwords:function(){var e=this.cm,n=e.getSelection(),r=e.listSelections();e.replaceSelection(t.wordsFirstUpperCase(n)),e.setSelections(r)},uppercase:function(){var e=this.cm,t=e.getSelection(),n=e.listSelections();e.replaceSelection(t.toUpperCase()),e.setSelections(n)},lowercase:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection(),r=e.listSelections();e.replaceSelection(n.toLowerCase()),e.setSelections(r)},h1:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("# "+n),e.setCursor(t.line,t.ch+2)):e.replaceSelection("# "+n)},h2:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("## "+n),e.setCursor(t.line,t.ch+3)):e.replaceSelection("## "+n)},h3:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("### "+n),e.setCursor(t.line,t.ch+4)):e.replaceSelection("### "+n)},h4:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("#### "+n),e.setCursor(t.line,t.ch+5)):e.replaceSelection("#### "+n)},h5:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("##### "+n),
e.setCursor(t.line,t.ch+6)):e.replaceSelection("##### "+n)},h6:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();t.ch!==0?(e.setCursor(t.line,0),e.replaceSelection("###### "+n),e.setCursor(t.line,t.ch+7)):e.replaceSelection("###### "+n)},"list-ul":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();if(n==="")e.replaceSelection("- "+n);else{var r=n.split("\n");for(var i=0,s=r.length;i<s;i++)r[i]=r[i]===""?"":"- "+r[i];e.replaceSelection(r.join("\n"))}},"list-ol":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();if(n==="")e.replaceSelection("1. "+n);else{var r=n.split("\n");for(var i=0,s=r.length;i<s;i++)r[i]=r[i]===""?"":i+1+". "+r[i];e.replaceSelection(r.join("\n"))}},hr:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection((t.ch!==0?"\n\n":"\n")+"------------\n\n")},tex:function(){if(!this.settings.tex)return alert("settings.tex === false"),this;var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection("$$"+n+"$$"),n===""&&e.setCursor(t.line,t.ch+2)},link:function(){this.executePlugin("linkDialog","link-dialog/link-dialog")},"reference-link":function(){this.executePlugin("referenceLinkDialog","reference-link-dialog/reference-link-dialog")},pagebreak:function(){if(!this.settings.pageBreak)return alert("settings.pageBreak === false"),this;var e=this.cm,t=e.getSelection();e.replaceSelection("\r\n[========]\r\n")},image:function(){this.executePlugin("imageDialog","image-dialog/image-dialog")},code:function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection("`"+n+"`"),n===""&&e.setCursor(t.line,t.ch+1)},"code-block":function(){this.executePlugin("codeBlockDialog","code-block-dialog/code-block-dialog")},"preformatted-text":function(){this.executePlugin("preformattedTextDialog","preformatted-text-dialog/preformatted-text-dialog")},table:function(){this.executePlugin("tableDialog","table-dialog/table-dialog")},datetime:function(){var e=this.cm,n=e.getSelection(),r=new Date,i=this.settings.lang.name,s=t.dateFormat()+" "+t.dateFormat(i==="zh-cn"||i==="zh-tw"?"cn-week-day":"week-day");e.replaceSelection(s)},emoji:function(){this.executePlugin("emojiDialog","emoji-dialog/emoji-dialog")},"html-entities":function(){this.executePlugin("htmlEntitiesDialog","html-entities-dialog/html-entities-dialog")},"goto-line":function(){this.executePlugin("gotoLineDialog","goto-line-dialog/goto-line-dialog")},watch:function(){this[this.settings.watch?"unwatch":"watch"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin("helpDialog","help-dialog/help-dialog")}},t.keyMaps={"Ctrl-1":"h1","Ctrl-2":"h2","Ctrl-3":"h3","Ctrl-4":"h4","Ctrl-5":"h5","Ctrl-6":"h6","Ctrl-B":"bold","Ctrl-D":"datetime","Ctrl-E":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();if(!this.settings.emoji){alert("Error: settings.emoji == false");return}e.replaceSelection(":"+n+":"),n===""&&e.setCursor(t.line,t.ch+1)},"Ctrl-Alt-G":"goto-line","Ctrl-H":"hr","Ctrl-I":"italic","Ctrl-K":"code","Ctrl-L":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection(),r=n===""?"":' "'+n+'"';e.replaceSelection("["+n+"]("+r+")"),n===""&&e.setCursor(t.line,t.ch+1)},"Ctrl-U":"list-ul","Shift-Ctrl-A":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();if(!this.settings.atLink){alert("Error: settings.atLink == false");return}e.replaceSelection("@"+n),n===""&&e.setCursor(t.line,t.ch+1)},"Shift-Ctrl-C":"code","Shift-Ctrl-Q":"quote","Shift-Ctrl-S":"del","Shift-Ctrl-K":"tex","Shift-Alt-C":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection();e.replaceSelection(["```",n,"```"].join("\n")),n===""&&e.setCursor(t.line,t.ch+3)},"Shift-Ctrl-Alt-C":"code-block","Shift-Ctrl-H":"html-entities","Shift-Alt-H":"help","Shift-Ctrl-E":"emoji","Shift-Ctrl-U":"uppercase","Shift-Alt-U":"ucwords","Shift-Ctrl-Alt-U":"ucfirst","Shift-Alt-L":"lowercase","Shift-Ctrl-I":function(){var e=this.cm,t=e.getCursor(),n=e.getSelection(),r=n===""?"":' "'+n+'"';e.replaceSelection("!["+n+"]("+r+")"),n===""&&e.setCursor(t.line,t.ch+4)},"Shift-Ctrl-Alt-I":"image","Shift-Ctrl-L":"link","Shift-Ctrl-O":"list-ol","Shift-Ctrl-P":"preformatted-text","Shift-Ctrl-T":"table","Shift-Alt-P":"pagebreak",F9:"watch",F10:"preview",F11:"fullscreen"};var i=function(e){return String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};t.trim=i;var s=function(e){return e.toLowerCase().replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()})};t.ucwords=t.wordsFirstUpperCase=s;var o=function(e){return e.toLowerCase().replace(/\b(\w)/,function(e){return e.toUpperCase()})},u=o;return t.firstUpperCase=t.ucfirst=o,t.urls={atLinkBase:"https://github.com/"},t.regexs={atLink:/@(\w+)/g,email:/(\w+)@(\w+)\.(\w+)\.?(\w+)?/g,emailLink:/(mailto:)?([\w\.\_]+)@(\w+)\.(\w+)\.?(\w+)?/g,emoji:/:([\w\+-]+):/g,emojiDatetime:/(\d{2}:\d{2}:\d{2})/g,twemoji:/:(tw-([\w]+)-?(\w+)?):/g,fontAwesome:/:(fa-([\w]+)(-(\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\w+)?):/g,pageBreak:/^\[[=]{8,}\]$/},t.emoji={path:"http://www.emoji-cheat-sheet.com/graphics/emojis/",ext:".png"},t.twemoji={path:"http://twemoji.maxcdn.com/36x36/",ext:".png"},t.markedRenderer=function(n,r){var s={toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},o=e.extend(s,r||{}),u=t.$marked,a=new u.Renderer;n=n||[];var f=t.regexs,l=f.atLink,c=f.emoji,h=f.email,p=f.emailLink,d=f.twemoji,v=f.fontAwesome,m=f.editormdLogo,g=f.pageBreak;return a.emoji=function(e){e=e.replace(t.regexs.emojiDatetime,function(e){return e.replace(/:/g,"&#58;")});var n=e.match(c);if(!n||!o.emoji)return e;for(var r=0,i=n.length;r<i;r++)n[r]===":+1:"&&(n[r]=":\\+1:"),e=e.replace(new RegExp(n[r]),function(e,n){var r=e.match(v),i=e.replace(/:/g,"");if(r)for(var s=0,o=r.length;s<o;s++){var u=r[s].replace(/:/g,"");return'<i class="fa '+u+' fa-emoji" title="'+u.replace("fa-","")+'"></i>'}else{var a=e.match(m),f=e.match(d);if(a)for(var l=0,c=a.length;l<c;l++){var h=a[l].replace(/:/g,"");return'<i class="'+h+'" title="Editor.md logo ('+h+')"></i>'}else{if(!f){var b=i==="+1"?"plus1":i;return b=b==="black_large_square"?"black_square":b,b=b==="moon"?"waxing_gibbous_moon":b,'<img src="'+t.emoji.path+b+t.emoji.ext+'" class="emoji" title="&#58;'+i+'&#58;" alt="&#58;'+i+'&#58;" />'}for(var p=0,g=f.length;p<g;p++){var y=f[p].replace(/:/g,"").replace("tw-","");return'<img src="'+t.twemoji.path+y+t.twemoji.ext+'" title="twemoji-'+y+'" alt="twemoji-'+y+'" class="emoji twemoji" />'}}}});return e},a.atLink=function(n){return l.test(n)?(o.atLink&&(n=n.replace(h,function(e,t,n,r){return e.replace(/@/g,"_#_&#64;_#_")}),n=n.replace(l,function(e,n){return'<a href="'+t.urls.atLinkBase+""+n+'" title="&#64;'+n+'" class="at-link">'+e+"</a>"}).replace(/_#_&#64;_#_/g,"@")),o.emailLink&&(n=n.replace(p,function(t,n,r,i,s){return!n&&e.inArray(s,"jpg|jpeg|png|gif|webp|ico|icon|pdf".split("|"))<0?'<a href="mailto:'+t+'">'+t+"</a>":t})),n):n},a.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return""}if(r.indexOf("javascript:")===0)return""}var s='<a href="'+e+'"';return l.test(t)||l.test(n)?(t&&(s+=' title="'+t.replace(/@/g,"&#64;")),s+'">'+n.replace(/@/g,"&#64;")+"</a>"):(t&&(s+=' title="'+t+'"'),s+=">"+n+"</a>",s)},a.heading=function(e,t,r){var s=e,o=/\s*\<a\s*href\=\"(.*)\"\s*([^\>]*)\>(.*)\<\/a\>\s*/,u=/\s*\<a\s*([^\>]+)\>([^\>]*)\<\/a\>\s*/g;if(o.test(e)){var a=[];e=e.split(/\<a\s*([^\>]+)\>([^\>]*)\<\/a\>/);for(var f=0,l=e.length;f<l;f++)a.push(e[f].replace(/\s*href\=\"(.*)\"\s*/g,""));e=a.join(" ")}e=i(e);var c=e.toLowerCase().replace(/[^\w]+/g,"-"),h={text:e,level:t,slug:c},p=/^[\u4e00-\u9fa5]+$/.test(e),d=p?escape(e).replace(/\%/g,""):e.toLowerCase().replace(/[^\w]+/g,"-");n.push(h);var v="<h"+t+' id="h'+t+"-"+this.options.headerPrefix+d+'">';return v+='<a name="'+e+'" class="reference-link"></a>',v+='<span class="header-link octicon octicon-link"></span>',v+=o?this.atLink(this.emoji(s)):this.atLink(this.emoji(e)),v+="</h"+t+">",v},a.pageBreak=function(e){return g.test(e)&&o.pageBreak&&(e='<hr style="page-break-after:always;" class="page-break editormd-page-break" />'),e},a.paragraph=function(e){var n=/\$\$(.*)\$\$/g.test(e),r=/^\$\$(.*)\$\$$/.test(e),i=r?' class="'+t.classNames.tex+'"':"",s=o.tocm?/^(\[TOC\]|\[TOCM\])$/.test(e):/^\[TOC\]$/.test(e),u=/^\[TOCM\]$/.test(e);!r&&n?e=e.replace(/(\$\$([^\$]*)\$\$)+/g,function(e,n){return'<span class="'+t.classNames.tex+'">'+n.replace(/\$/g,"")+"</span>"}):e=r?e.replace(/\$/g,""):e;var a='<div class="markdown-toc editormd-markdown-toc">'+e+"</div>";return s?u?'<div class="editormd-toc-menu">'+a+"</div><br/>":a:g.test(e)?this.pageBreak(e):"<p"+i+">"+this.atLink(this.emoji(e))+"</p>\n"},a.code=function(e,n,r){return n==="seq"||n==="sequence"?'<div class="sequence-diagram">'+e+"</div>":n==="flow"?'<div class="flowchart">'+e+"</div>":n==="math"||n==="latex"||n==="katex"?'<p class="'+t.classNames.tex+'">'+e+"</p>":u.Renderer.prototype.code.apply(this,arguments)},a.tablecell=function(e,t){var n=t.header?"th":"td",r=t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">";return r+this.atLink(this.emoji(e))+"</"+n+">\n"},a.listitem=function(e){return o.taskList&&/^\s*\[[x\s]\]\s*/.test(e)?(e=e.replace(/^\s*\[\s\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" /> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" checked disabled /> '),'<li style="list-style: none;">'+this.atLink(this.emoji(e))+"</li>"):"<li>"+this.atLink(this.emoji(e))+"</li>"},a},t.markdownToCRenderer=function(e,t,n,r){var i="",s=0,o=this.classPrefix;r=r||1;for(var u=0,a=e.length;u<a;u++){var f=e[u].text,l=e[u].level;if(l<r)continue;l>s?i+="":l<s?i+=(new Array(s-l+2)).join("</ul></li>"):i+="</ul></li>",i+='<li><a class="toc-level-'+l+'" href="#'+f+'" level="'+l+'">'+f+"</a><ul>",s=l}var c=t.find(".markdown-toc");if(c.length<1&&t.attr("previewContainer")==="false"){var h='<div class="markdown-toc '+o+'markdown-toc"></div>';h=n?'<div class="'+o+'toc-menu">'+h+"</div>":h,t.html(h),c=t.find(".markdown-toc")}return n&&c.wrap('<div class="'+o+'toc-menu"></div><br/>'),c.html('<ul class="markdown-toc-list"></ul>').children(".markdown-toc-list").html(i.replace(/\r?\n?\<ul\>\<\/ul\>/g,"")),c},t.tocDropdownMenu=function(t,n){n=n||"Table of Contents";var r=400,i=t.find("."+this.classPrefix+"toc-menu");return i.each(function(){var t=e(this),i=t.children(".markdown-toc"),s='<i class="fa fa-angle-down"></i>',o='<a href="javascript:;" class="toc-menu-btn">'+s+n+"</a>",u=i.children("ul"),a=u.find("li");i.append(o),a.first().before("<li><h1>"+n+" "+s+"</h1></li>"),t.mouseover(function(){u.show(),a.each(function(){var t=e(this),n=t.children("ul");n.html()===""&&n.remove();if(n.length>0&&n.html()!==""){var i=t.children("a").first();i.children(".fa").length<1&&i.append(e(s).css({"float":"right",paddingTop:"4px"}))}t.mouseover(function(){n.css("z-index",r).show(),r+=1}).mouseleave(function(){n.hide()})})}).mouseleave(function(){u.hide()})}),i},t.filterHTMLTags=function(t,n){typeof t!="string"&&(t=new String(t));if(typeof n!="string")return t;var r=n.split("|"),i=r[0].split(","),s=r[1];for(var o=0,u=i.length;o<u;o++){var a=i[o];t=t.replace(new RegExp("<s*"+a+"s*([^>]*)>([^>]*)<s*/"+a+"s*>","igm"),"")}if(typeof s!="undefined"){var f=/\<(\w+)\s*([^\>]*)\>([^\>]*)\<\/(\w+)\>/ig;s==="*"?t=t.replace(f,function(e,t,n,r,i){return"<"+t+">"+r+"</"+i+">"}):s==="on*"?t=t.replace(f,function(t,n,r,i,s){var o=e("<"+n+">"+i+"</"+s+">"),u=e(t)[0].attributes,a={};e.each(u,function(e,t){t.nodeName!=='"'&&(a[t.nodeName]=t.nodeValue)}),e.each(a,function(e){e.indexOf("on")===0&&delete a[e]}),o.attr(a);var f=typeof o[1]!="undefined"?e(o[1]).text():"";return o[0].outerHTML+f}):t=t.replace(f,function(t,n,r,i){var o=s.split(","),u=e(t);return u.html(i),e.each(o,function(e){u.attr(o[e],null)}),u[0].outerHTML})}return t},t.markdownToHTML=function(n,r){var i={gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:"目录",tocDropdown:!1,tocContainer:"",markdown:"",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,previewTheme:""};t.$marked=marked;var s=e("#"+n),o=s.settings=e.extend(!0,i,r||{}),u=s.find("textarea");u.length<1&&(s.append("<textarea></textarea>"),u=s.find("textarea"));var a=o.markdown===""?u.val():o.markdown,f=[],l={toc:o.toc,tocm:o.tocm,tocStartLevel:o.tocStartLevel,taskList:o.taskList,emoji:o.emoji,tex:o.tex,pageBreak:o.pageBreak,atLink:o.atLink,emailLink:o.emailLink,flowChart:o.flowChart,sequenceDiagram:o.sequenceDiagram,previewCodeHighlight:o.previewCodeHighlight,previewTheme:o.previewTheme},c={renderer:t.markedRenderer(f,l),gfm:o.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:o.htmlDecode?!1:!0,smartLists:!0,smartypants:!0};a=new String(a);var h=marked(a,c);h=t.filterHTMLTags(h,o.htmlDecode),o.markdownSourceCode?u.text(a):u.remove(),s.addClass("markdown-body "+this.classPrefix+"html-preview "),o.previewTheme!=""&&s.addClass("markdown-body "+this.classPrefix+"preview-theme-"+o.previewTheme),s.append(h);var p=o.tocContainer!==""?e(o.tocContainer):s;o.tocContainer!==""&&p.attr("previewContainer",!1),o.toc&&(s.tocContainer=this.markdownToCRenderer(f,p,o.tocDropdown,o.tocStartLevel),(o.tocDropdown||s.find("."+this.classPrefix+"toc-menu").length>0)&&this.tocDropdownMenu(s,o.tocTitle),o.tocContainer!==""&&s.find(".editormd-toc-menu, .editormd-markdown-toc").remove()),o.previewCodeHighlight&&(s.find("pre").addClass("prettyprint linenums"),prettyPrint()),t.isIE8||(o.flowChart&&s.find(".flowchart").flowChart(),o.sequenceDiagram&&s.find(".sequence-diagram").sequenceDiagram({theme:"simple"}));if(o.tex){var d=function(){s.find("."+t.classNames.tex).each(function(){var t=e(this);katex.render(t.html().replace(/&lt;/g,"<").replace(/&gt;/g,">"),t[0]),t.find(".katex").css("font-size","1.6em")})};o.autoLoadKaTeX&&!t.$katex&&!t.kaTeXLoaded?this.loadKaTeX(function(){t.$katex=katex,t.kaTeXLoaded=!0,d()}):d()}return s.getMarkdown=function(){return u.val()},s},t.themes=["default","dark"],t.previewThemes=["default","dark"],t.editorThemes=["default","3024-day","3024-night","ambiance","ambiance-mobile","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","mdn-like","midnight","monokai","neat","neo","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized","the-matrix","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark","xq-light"],t.loadPlugins={},t.loadFiles={js:[],css:[],plugin:[]},t.loadPlugin=function(e,n,r){n=n||function(){},this.loadScript(e,function(){t.loadFiles.plugin.push(e),n()},r)},t.loadCSS=function(e,n,r){r=r||"head",n=n||function(){};var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.onload=i.onreadystatechange=function(){t.loadFiles.css.push(e),n()},i.href=e+".css",r==="head"?document.getElementsByTagName("head")[0].appendChild(i):document.body.appendChild(i)},t.isIE=navigator.appName=="Microsoft Internet Explorer",t.isIE8=t.isIE&&navigator.appVersion.match(/8./i)=="8.",t.loadScript=function(e,n,r){r=r||"head",n=n||function(){};var i=null;i=document.createElement("script"),i.id=e.replace(/[\./]+/g,"-"),i.type="text/javascript",i.src=e+".js",t.isIE8?i.onreadystatechange=function(){i.readyState&&(i.readyState==="loaded"||i.readyState==="complete")&&(i.onreadystatechange=null,t.loadFiles.js.push(e),n())}:i.onload=function(){t.loadFiles.js.push(e),n()},r==="head"?document.getElementsByTagName("head")[0].appendChild(i):document.body.appendChild(i)},t.katexURL={css:"//cdn.bootcss.com/KaTeX/0.5.1/katex.min",js:"//cdn.bootcss.com/KaTeX/0.5.1/katex.min"},t.kaTeXLoaded=!1,t.loadKaTeX=function(e){t.loadCSS(t.katexURL.css,function(){t.loadScript(t.katexURL.js,e||function(){})})},t.lockScreen=function(t){e("html,body").css("overflow",t?"hidden":"")},t.createDialog=function(n){var r={name:"",width:420,height:240,title:"",drag:!0,closed:!0,content:"",mask:!0,maskStyle:{backgroundColor:"#fff",opacity:.1},lockScreen:!0,footer:!0,buttons:!1};n=e.extend(!0,r,n);var i=this,s=this.editor,o=t.classPrefix,u=(new Date).getTime(),a=n.name===""?o+"dialog-"+u:n.name,f=t.mouseOrTouch,l='<div class="'+o+"dialog "+a+'">';n.title!==""&&(l+='<div class="'+o+'dialog-header"'+(n.drag?' style="cursor: move;"':"")+">",l+='<strong class="'+o+'dialog-title">'+n.title+"</strong>",l+="</div>"),n.closed&&(l+='<a href="javascript:;" class="fa fa-close '+o+'dialog-close"></a>'),l+='<div class="'+o+'dialog-container">'+n.content;if(n.footer||typeof n.footer=="string")l+='<div class="'+o+'dialog-footer">'+(typeof n.footer=="boolean"?"":n.footer)+"</div>";l+="</div>",l+='<div class="'+o+"dialog-mask "+o+'dialog-mask-bg"></div>',l+='<div class="'+o+"dialog-mask "+o+'dialog-mask-con"></div>',l+="</div>",s.append(l);var c=s.find("."+a);c.lockScreen=function(t){return n.lockScreen&&(e("html,body").css("overflow",t?"hidden":""),i.resize()),c},c.showMask=function(){return n.mask&&s.find("."+o+"mask").css(n.maskStyle).css("z-index",t.dialogZindex-1).show(),c},c.hideMask=function(){return n.mask&&s.find("."+o+"mask").hide(),c},c.loading=function(e){var t=c.find("."+o+"dialog-mask");return t[e?"show":"hide"](),c},c.lockScreen(!0).showMask(),c.show().css({zIndex:t.dialogZindex,border:t.isIE8?"1px solid #ddd":"",width:typeof n.width=="number"?n.width+"px":n.width,height:typeof n.height=="number"?n.height+"px":n.height});var h=function(){c.css({top:(e(window).height()-c.height())/2+"px",left:(e(window).width()-c.width())/2+"px"})};h(),e(window).resize(h),c.children("."+o+"dialog-close").bind(f("click","touchend"),function(){c.hide().lockScreen(!1).hideMask()});if(typeof n.buttons=="object"){var p=c.footer=c.find("."+o+"dialog-footer");for(var d in n.buttons){var v=n.buttons[d],m=o+d+"-btn";p.append('<button class="'+o+"btn "+m+'">'+v[0]+"</button>"),v[1]=e.proxy(v[1],c),p.children("."+m).bind(f("click","touchend"),v[1])}}if(n.title!==""&&n.drag){var g,y,b=c.children("."+o+"dialog-header");n.mask||b.bind(f("click","touchend"),function(){t.dialogZindex+=2,c.css("z-index",t.dialogZindex)}),b.mousedown(function(e){e=e||window.event,g=e.clientX-parseInt(c[0].style.left),y=e.clientY-parseInt(c[0].style.top),document.onmousemove=S});var w=function(e){e.removeClass(o+"user-unselect").off("selectstart")},E=function(e){e.addClass(o+"user-unselect").on("selectstart",function(e){return!1})},S=function(t){t=t||window.event;var n,r,i=parseInt(c[0].style.left),s=parseInt(c[0].style.top);i>=0?i+c.width()<=e(window).width()?n=t.clientX-g:(n=e(window).width()-c.width(),document.onmousemove=null):(n=0,document.onmousemove=null),s>=0?r=t.clientY-y:(r=0,document.onmousemove=null),document.onselectstart=function(){return!1},E(e("body")),E(c),c[0].style.left=n+"px",c[0].style.top=r+"px"};document.onmouseup=function(){w(e("body")),w(c),document.onselectstart=null,document.onmousemove=null},b.touchDraggable=function(){var t=null,n=function(n){var r=n.originalEvent,i=e(this).parent().position();t={x:r.changedTouches[0].pageX-i.left,y:r.changedTouches[0].pageY-i.top}},r=function(n){n.preventDefault();var r=n.originalEvent;e(this).parent().css({top:r.changedTouches[0].pageY-t.y,left:r.changedTouches[0].pageX-t.x})};this.bind("touchstart",n).bind("touchmove",r)},b.touchDraggable()}return t.dialogZindex+=2,c},t.mouseOrTouch=function(e,t){e=e||"click",t=t||"touchend";var n=e;try{document.createEvent("TouchEvent"),n=t}catch(r){}return n},t.dateFormat=function(e){e=e||"";var t=function(e){return e<10?"0"+e:e},n=new Date,r=n.getFullYear(),i=r.toString().slice(2,4),s=t(n.getMonth()+1),o=t(n.getDate()),u=n.getDay(),a=t(n.getHours()),f=t(n.getMinutes()),l=t(n.getSeconds()),c=t(n.getMilliseconds()),h="",p=i+"-"+s+"-"+o,d=r+"-"+s+"-"+o,v=a+":"+f+":"+l;switch(e){case"UNIX Time":h=n.getTime();break;case"UTC":h=n.toUTCString();break;case"yy":h=i;break;case"year":case"yyyy":h=r;break;case"month":case"mm":h=s;break;case"cn-week-day":case"cn-wd":var m=["日","一","二","三","四","五","六"];h="星期"+m[u];break;case"week-day":case"wd":var g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];h=g[u];break;case"day":case"dd":h=o;break;case"hour":case"hh":h=a;break;case"min":case"ii":h=f;break;case"second":case"ss":h=l;break;case"ms":h=c;break;case"yy-mm-dd":h=p;break;case"yyyy-mm-dd":h=d;break;case"yyyy-mm-dd h:i:s ms":case"full + ms":h=d+" "+v+" "+c;break;case"full":case"yyyy-mm-dd h:i:s":default:h=d+" "+v}return h},t});